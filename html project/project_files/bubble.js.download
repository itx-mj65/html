!function(){function t(t,e,i,o){Object.defineProperty(t,e,{get:i,set:o,enumerable:!0,configurable:!0})}var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire94c2,i=e.register;i("9Du8u",function(i,o){Object.defineProperty(i.exports,"__esModule",{value:!0,configurable:!0}),t(i.exports,"default",function(){return D});var n=e("7Tj0o"),r=e("1A9Dw"),s=e("e8kzi"),a=e("iVPxJ"),l=e("aQK74"),d=e("eSOI5"),u=e("xb7kn"),c=e("jvykV"),b=e("kK0IS"),g=e("68VIL"),h=e("8ptJJ"),p=e("kCbDV"),y=e("8ZCcc"),f=e("hZHHs"),w=e("a78DZ"),m=e("2Aomz"),B=e("girDi"),v=e("f4aGe"),T=e("e0F8o");let C="tolstoyWidgetElement",S=new Set(["460a6fc1-9de8-4290-993f-2bc25596b514","2b670e56-2880-4336-8e55-5b44733be3b4"]),M=new Set(["460a6fc1-9de8-4290-993f-2bc25596b514","2b670e56-2880-4336-8e55-5b44733be3b4","bad33e34-e461-415a-9910-3dd540c97180","dd3729a4-1a63-4fb7-b7dc-576345594244","7603e5ee-58cd-4920-bf09-9f644f738145","bd534d8e-1a1b-44af-9ea8-611b2833a93b","1991a226-da83-4f8d-9938-c92c1e969567","f084cc71-7467-451c-bb4b-2aab94e67a33","3784226a-f0c9-4471-b6e0-391a2528f071","d431a7e5-b408-4084-b508-87366992d127","74fce90c-7f23-4634-88a8-325ab738e214","b427f89d-f5f8-4e91-b38e-6da7cc6c3f79"]),E=new Set(["jofx8mtqunjs6","jx1p0q2v226gh","pyzpw5e954d32","r990zbqkzl6d9"]),x=new Set(["qevw6h5rg09ds"]),_=new Set(["878575d1-eec3-448c-a18a-09882529e447","cb0b596e-0dfe-4e38-9167-a4e231342916","4b36fcdf-f740-4719-ad61-9b9d1c69cf2f"]),I=new Set(["185cde2d-c2c4-4b0c-9fc8-82d6245c7ed6"]),R=(t={})=>t.widgetDelay;var D=class{constructor(t){this.initialized=!1,this.name=p.BUBBLE_WIDGET,this.bubbleSettings=t,this.config=null,this.onWidgetReady=null,this.opened=!1,this.isBubbleTextOpen=!0,this.openDelayed=!1,this.pendingInterval=null,this.slideEnabled=!1,this.previewLoaded=!1,this.posterError=!1,this.videoLoadingTimeout=null,this.rules=new w.default,this.modalMessageHandler=this.modalMessageHandler.bind(this),this.openPublishIds=new Set,this.bubbleWasVisibleOnModalOpen=!1}async init(t={}){if(!this.widgetId)return;let e=await (0,b.getProjectConfig)(this.widgetId,p.BUBBLE_WIDGET),i=new r.default(p.BUBBLE_WIDGET).init(e)||{};if(!e||e.disabled||i.hideElement)return;(0,l.setImpressionByPublishId)(this.widgetId,!0);let o=e?.design?.branding?.typography?.font||{},n=e?.design?.branding?.typography?.fontHeading||{};o?.family&&(0,c.reloadFont)(o),n?.family&&(0,c.reloadFont)(n,"tolstoy-custom-heading-font-family"),e.widgetNotificationBadge&&(this.opened=(0,d.getShowNotificationBadge)(this.widgetId)),e.bubbleTextEnabled&&e.bubbleText&&(this.opened=(0,d.getShowBubbleText)(this.widgetId,e.bubbleText));let s=new URLSearchParams(window.location.search).get("gclid");s&&(e.gclid=s),R(this.bubbleSettings)&&(e.widgetDelay=this.bubbleSettings.widgetDelay),(0,y.getIsPlayerLazy)(e)&&(e.playerLazy=!0),this.initElements({...e,...t,...window.tolstoySettings,dontDownload:!0})}setBubblePosition(t){let e=t.bubbleMarginBottom??30,i=t.bubbleMarginSide??35;window.innerWidth<=450&&(e-=14),e+this.widget.clientHeight>=window.innerHeight&&(e=window.innerHeight-this.widget.clientHeight-10),i+this.widget.clientWidth>=window.innerWidth&&(i=window.innerWidth-this.widget.clientWidth-10),this.widget.style.setProperty?.("bottom",`${e}px`,"important");let o="bottomLeft"===t.widgetPosition?"left":"right";this.widget.style.setProperty?.(o,`${i}px`,"important")}initElements(t){if(!this.shouldLoadWidget(t.alwaysShow,t.widgetUrls,this.bubbleSettings?.appKey)){if((t.showPlayerImmediately||t.autoplay)&&(t.dontDownload=!1),this.slideEnabled=t.slideEnabled,this.projectId=t.id,t.playerType="bubble",this.modal=new f.default(t),document.querySelector(`#${C}`)?.remove(),this.widget=document.createElement("div"),this.widget.setAttribute("role","group"),this.widget.ariaLabel="Tolstoy bubble widget",this.widget.setAttribute("id",C),this.widget.setAttribute(a.DATA_TEST_ID,a.WIDGET_ELEMENT_DATA_TEST_ID),t.showPlayerImmediately&&this.modal?.open(),(t.border||t.widgetBorderColor&&"false"!==t.widgetBorderColor)&&I.has(this.bubbleSettings.appKey)&&this.widget.style.setProperty?.("z-index","2147483646","important"),this.setDisplaySettings(t,this.widget),this.loadInto(t,this.widget),this.setBubblePosition(t),this.addModalOpenEvents(),this.subscribeForPlayerReady(),this.initialized=!0,t.loadHidden&&this.hide(),this.slideEnabled){let e=this.getAnimationStartPosition(t);this.widget.style.setProperty("transform",e,"important"),this.widget.style.setProperty("transition","0.01s","important")}t.widgetDelay&&(this.widgetDelayOffseted=1e3*t.widgetDelay,this.openDelayed=!0),t.resolution=640,this.config=t}}bubblePostEvent({eventName:t}){this.config.playerLazy&&this.modal.sendEvent(t)}async recreate(t,e={}){t&&this.widgetId!==t&&(this.widgetId=t,this.modal?.remove(),this.widget?.remove(),await this.init({alwaysShow:!0,loadHidden:!1,...e}),e.startPlayerImmediately&&window.addEventListener("message",t=>{t.data&&t.data.eventName===h.TOLSTOY_PLAYER_READY_MESSAGE&&this.start()}))}savePlayCount(t){let e=(0,d.getTolstoyViewers)();if(e[t]){let i=e[t].playCount;e[t].playCount=i?i+1:1}else e[t]={impressionCount:1,playCount:1};(0,d.setTolstoyViewers)(e)}open(t){if(this.rules.updateRestrictions(p.STOP_SHOWING_WIDGET_TO.viewed,this.widgetId),this.isBubbleTextOpen&&t.bubbleTextEnabled){let t=document.querySelector(".tolstoy-bubble-text-container");t?.remove()}if(this.savePlayCount(this.widgetId),this.savePlayCount("undefined"),this.modal?.open(),this.opened=!0,t.bubbleTextEnabled&&(0,d.setShowBubbleText)(this.widgetId,t.bubbleText,!0),t.widgetNotificationBadge){(0,d.setShowNotificationBadge)(this.widgetId,"true");let e=document.querySelector(".close-tolstoy-button");e&&(e.classList.remove(B.closeButtonBadgeColor),e.innerHTML=g.xButtonsSvg),t.noCloseOption&&e.remove()}}eventChange(t,e){switch(t){case"onWidgetClose":case"onWidgetOpen":return this.modal?.changeEvent(t,e);case"onWidgetReady":return this.changeEvent(t,e);default:return null}}changeEvent(t,e){this[t]=e}addMobileClass(t,e){return e?null:v[t]}setDisplaySettings(t,e){e.classList.add("tolstoy-widget",B.tolstoyBubble,this.addMobileClass("tolstoyBubble",t.keepSettingsOnMobile),S.has(this.bubbleSettings.appKey)&&B.tolstoyButtonWithInstagramBorder,this.selectMinifiedClass(t.minified,"tolstoyButton",t.widgetShape,t.widgetSize)),"bottomLeft"===t.widgetPosition?e.classList.add(B.tolstoyButtonBottomLeft,v.tolstoyButtonBottomLeft,this.selectMinifiedClass(t.minified,"tolstoyButtonBottomLeft",t.widgetShape,t.widgetSize)):e.classList.add(B.tolstoyButtonBottomRight,v.tolstoyButtonBottomRight,this.selectMinifiedClass(t.minified,"tolstoyButtonBottomRight",t.widgetShape,t.widgetSize))}setWidgetHeader(t){if(!t.widgetHeader)return"";let e=`${B.widgetHeaderContainer}
        ${this.addMobileClass("widgetHeaderContainer",t.keepSettingsOnMobile)}
    ${S.has(this.bubbleSettings.appKey)?`${B.widgetHeaderContainerWithInstagram}
                ${this.addMobileClass("widgetHeaderContainerWithInstagram",t.keepSettingsOnMobile)}
        `:""} ${this.selectMinifiedClass(t.minified,"widgetHeaderContainer",t.widgetShape,t.widgetSize)}`;this.getBorderCss(t)&&(e+=` ${B.widgetHeaderContainerWithBorder}`);let i=t.widgetHeaderLocation,o=B[`widgetHeaderAlignment-${i}`]||"",n=t?.featureSettings?.[T.FEATURE_WIDGET_HEADER_CUSTOMIZATION]?.fontSize,r=`tolstoy-widget-header
     ${this.addMobileClass("widgetHeader",t.keepSettingsOnMobile)}
     ${B.widgetHeader} ${this.selectMinifiedClass(t.minified,"widgetHeader",t.widgetShape,t.widgetSize)} ${o}`;return`<div class="${e}">
<div aria-label="${t.widgetHeader}" class="${r}" style="font-size: ${n}px;line-height: ${n+2}px">${t.widgetHeader}</div>
</div>`}selectMinifiedClass(t,e,i,o){return t||"s"===o&&"circle"===i?B[`${e}Small`]:("circle"!==i||o)&&("circle"!==i||"m"!==o)?"circle"===i&&"l"===o?B[`${e}CircleLarge`]:"no-change":B[`${e}Circle`]}subscribeForPlayerReady(){window.addEventListener("message",t=>{t.data&&t.data.eventName===h.TOLSTOY_PLAYER_READY_MESSAGE&&(this.onWidgetReady?.(),window.postMessage({name:"tolstoyWidgetReady"},"*"),(0,u.tolstoyPlayerReady)(),this.display())})}getBubbleHtml(t){let e=`tolstoy-text-bubble-container ${B.tolstoyBubbleContainer} `;t.verticalOrientation?e+=`${B.tolstoyButtonVertical}
                  ${this.addMobileClass("tolstoyButtonVertical",t.keepSettingsOnMobile)}
        ${this.selectMinifiedClass(t.minified,"tolstoyButtonVertical",t.widgetShape,t.widgetSize)}`:e+=`${B.tolstoyButtonHorizontal}
                           ${this.addMobileClass("tolstoyButtonHorizontal",t.keepSettingsOnMobile)}
      ${this.selectMinifiedClass(t.minified,"tolstoyButtonHorizontal",t.widgetShape,t.widgetSize)}`;let i=`<div role="button" aria-label="Open Tolstoy widget" class="${e}"  ${a.DATA_TEST_ID}="${a.TOLSTOY_TEXT_BUBBLE_DATA_TEST_ID}">`;return i+=this.setWidgetHeader(t),i+=this.getCloseButton(t),i+=this.createVideoElement(t),i+="</div>"}getBubbleTextHtml(t){let e=`tolstoy-bubble-text-container ${B.tolstoyBubbleTextContainer}`;return t.verticalOrientation&&(e+=` ${B.tolstoyBubbleVerticalContainer}`),`
<div class="${e}">
<div role="button" aria-label="Open Tolstoy widget" class="${B.tolstoyBubbleTextTextContainer} tolstoy-bubble-text-text-container">
<div aria-label="${t.bubbleText}" class="${B.tolstoyBubbleText}
                       ${this.addMobileClass("tolstoyBubbleText",t.keepSettingsOnMobile)}
">${t.bubbleText}</div>
</div></div>`}getBubbleTextOffset(t){let e="bottomLeft"===t.widgetPosition?"right":"left",i="circle"===t.widgetShape,o="rectangle"===t.widgetShape,n="s"===t.widgetSize&&i,r="l"===t.widgetSize&&i,s=8;return(n||o)&&(s=12),r&&(s=4),(t.border||t.widgetBorderColor)&&(s+=6),{position:e,offset:s,bottom:8}}getBubbleTextBorderRadius(t){let e="bottomLeft"===t.widgetPosition?"left":"right",i="circle"===t.widgetShape;if(!("s"===t.widgetSize&&i))return"12px";switch(e){case"right":return"12px 12px 0 12px";case"left":return"12px 12px 12px 0";default:return"12px"}}getContentContainerFlexDirection(t){let e="bottomLeft"===t.widgetPosition?"left":"right",i="circle"===t.widgetShape;return"s"===t.widgetSize&&i?"left"===e?"row":"row-reverse":"column-reverse"}addBubbleTextColor(t){let e=document.querySelector(".tolstoy-bubble-text-text-container"),i=document.querySelector(".tolstoy-bubble-text-container"),o=document.querySelector(".tolstoy-content-container"),n="circle"===t.widgetShape&&"s"===t.widgetSize;if(!e||!t.bubbleTextEnabled||!t.bubbleText)return;let{position:r,offset:s}=this.getBubbleTextOffset(t),a=this.getBubbleTextBorderRadius(t);i.style.borderRadius=`${a}`,e.style.borderRadius=`${a}`,e.style[r]="-1000px",e.style[r]=`-${e.clientWidth+s}px`,o.style.flexDirection=`${this.getContentContainerFlexDirection(t)}`,o.style.gap=`${s}px`,n&&(i.style.alignSelf="flex-start",i.style.height="fit-content",o.style.gap="4px"),t.themeColor&&(e.style.background=t.themeColor,e.style.color=t.themeTextColor);let l=document.querySelector(".tolstoy-text-bubble-container");e.style.maxHeight=`${l.clientHeight}px`}addBubbleTextEvents(t){let e=document.querySelector(".tolstoy-bubble-text-container"),i=document.querySelector(".tolstoy-bubble-text-text-container");if(!e)return;i?.addEventListener("click",()=>this.open(t));let{position:o,offset:n,bottom:r}=this.getBubbleTextOffset(t);e.style[o]="-1000000px",e.style[o]=`-${e.clientWidth+n}px`,e.style.bottom=`${r}px`,this.opened||(this.isBubbleTextOpen=!this.isBubbleTextOpen),(t=>{this.isBubbleTextOpen?(i.style.left="100000px",e.style.visibility="",i.style.pointerEvents="none"):(i.style.left="0",e.style.visibility="visible",i.style.pointerEvents=""),this.isBubbleTextOpen=!this.isBubbleTextOpen})()}loadInto(t,e){let i=`<div role="button" aria-label="Open Tolstoy"  tabindex="0" class="${B.tolstoyContentContainer} ${a.TOLSTOY_CONTENT_CONTAINER}">`;i+=this.getBubbleHtml(t),t.bubbleTextEnabled&&t.bubbleText&&(i+=this.getBubbleTextHtml(t)),i+="</div>",e.innerHTML=i,this.subscribeToVideoLoaded(e),document.body.append(e),this.subscribeEvents(t),this.subscribeVideoEvents(t),this.addBubbleTextColor(t),this.addBubbleTextEvents(t)}displayInterval(t){if(!this.widgetDelayOffseted)return;this.startTime||(this.startTime=window.performance.now());let e=window.performance.now()-this.startTime,i=this.widgetDelayOffseted-e;if(i<=0){this.openDelayed=!1,this.pendingInterval=null,this.startTime=null,this.display(t),this.modal.delayedShow();return}this.pendingInterval=setTimeout(()=>{this.displayInterval(t)},Math.min(500,i))}scheduleDisplayInterval(){this.pendingInterval||(this.startTime=null,this.displayInterval())}getAnimationStartPosition(t){let e="bottom"===t.slideFrom,i=e?"translateY":"translateX";return e?`${i}(calc(100% + ${t.bubbleMarginBottom+35}px))`:"bottomLeft"===t.widgetPosition?`${i}(calc(-100% - ${t.bubbleMarginSide+45}px ))`:`${i}(calc(100% + ${t.bubbleMarginSide+35}px ))`}bubbleAnimation=()=>{this.widget.style.removeProperty("transform"),this.widget.style.removeProperty("transition"),this.bubbleAnimationOccurred=!0};addBubbleAnimationListener(){this.widget.addEventListener("transitionend",this.bubbleAnimation,{once:!0})}display(){if("1"!==this.widget.style.opacity&&this.previewLoaded){if(clearTimeout(this.videoLoadingTimeout),this.openDelayed)return this.scheduleDisplayInterval();this.slideEnabled&&this.addBubbleAnimationListener(),this.widget.style.opacity=1,this.bubblePostEvent({eventName:"pageView"})}}focusWidgetContainer(){let t=document.querySelector(`.${a.TOLSTOY_CONTENT_CONTAINER}`);t?.focus?.()}handleOpeningModal(t,e){0===this.openPublishIds.size&&(this.bubbleWasVisibleOnModalOpen="none"!==t.style.display),t.style.display="none",this.openPublishIds.add(e)}handleClosingModal(t){this.openPublishIds.delete(t)}handleClosingLastModal(t){this.bubbleWasVisibleOnModalOpen?(t.style.display="block",this.focusWidgetContainer()):t.style.display="none"}handleShowBubbleFromEmailCampaign(t){if(this.openPublishIds.size>0){this.bubbleWasVisibleOnModalOpen=!0;return}t.style.display="block",this.slideEnabled&&!this.bubbleAnimationOccurred&&requestAnimationFrame(this.bubbleAnimation),this.focusWidgetContainer()}handleHideBubbleFromEmailCampaign(t){if(this.openPublishIds.size>0){this.bubbleWasVisibleOnModalOpen=!1;return}t.style.display="none"}modalMessageHandler({data:t}){if(t.name!==h.WIDGETS_MESSAGES)return;let e=t.eventData?.hideBubblePreview,i=t.eventData?.showPreviouslyHiddenBubblePreview,o=t.eventData?.showBubbleFromEmailCampaign,n=t.eventData?.hideBubbleFromEmailCampaign,r=t.eventData?.publishId,s={[h.WIDGET_MESSAGES_EVENTS.OPEN]:t=>{e&&this.handleOpeningModal(t,r)},[h.WIDGET_MESSAGES_EVENTS.CLOSE]:t=>{this.handleClosingModal(r),o?this.handleShowBubbleFromEmailCampaign(t):n?this.handleHideBubbleFromEmailCampaign(t):i&&0===this.openPublishIds.size&&this.handleClosingLastModal(t)}}[t.type];s?.(this.widget)}addModalOpenEvents(){window.addEventListener("message",this.modalMessageHandler)}hide(t,e){this.initialized&&(t?.stopPropagation(),this.widget.style.display="none",e&&(0,d.setTolstoyHideWidget)(this.widgetId),this.modal?.hide(!1),window.postMessage({name:"onTolstoyClose"},"*"))}start(){this.initialized&&this.modal?.open()}startPart(t){this.initialized&&this.modal?.open(t)}show(){this.initialized&&"inline"!==this.widget.style.display&&(this.widget.style.display="inline",this.modal?.show(),(0,d.removeTolstoyHideWidget)(this.widgetId))}getBorderCss(t){return t.border||t.widgetBorderColor&&"false"!==t.widgetBorderColor?`border: 6px solid ${t.themeColor||t.widgetBorderColor}`:""}getObjectPosition(t){let e=t.bubbleObjectPosition;return e?`object-position:${e.x}% ${e.y}% !important;`:""}createVideoElement(t){let e;let i=`tolstoy-widget-video ${B.videoPlayer}
    ${this.addMobileClass("videoPlayer",t.keepSettingsOnMobile)}
	${S.has(this.bubbleSettings.appKey)?B.videoPlayerWithInstagramBorder:""}
	${M.has(this.bubbleSettings.appKey)?B.tolstoyVideoPositionTop:""}
  ${E.has(this.widgetId)?B.tolstoyVideoPositionTop:""}
  ${x.has(this.widgetId)?B.tolstoyVideoPositionBottom:""}
	${_.has(this.bubbleSettings.appKey)?B.tolstoyFaceCloseUp:""}
	 ${this.selectMinifiedClass(t.minified,"videoPlayer",t.widgetShape,t.widgetSize)}
	 `,o="preview";return e=(0,y.getIsFallbackVideoDisabled)(t)?`<source class="tolstoy-last-video-source" src="${this.getFirstVideo(t,o)}"/>`:`<source src="${this.getFirstVideo(t,o)}"/>
					   <source src="${this.getFirstVideo(t,640)}"/>
					   <source class="tolstoy-last-video-source" src="${this.getFirstVideo(t)}"/>`,`<video  preload="none" aria-label="Tolstoy video preview : ${t.name}"  disableRemotePlayback class="${i}"  ${a.DATA_TEST_ID}="${a.TOLSTOY_WIDGET_VIDEO_DATA_TEST_ID}" style="z-index: 1; ${this.getObjectPosition(t)}  ${this.getBorderCss(t)}" ${t.stopPreviewLoop?"":"loop"} autoPlay muted volume=0 playsinline poster="${this.getVideoPoster(t)}">${e}</video>
`}getVideoPoster(t){let e=t.steps.find(e=>e.key===t.startStep),i=(0,s.getPosterUrlFromStockAsset)(e.stockAsset);if(i)return i;let o=this.getVideoBaseUrl(t.baseUrl),n=e?.videoOwner||t?.owner;return(0,s.buildUrl)({path:o,ownerId:n,assetId:e.videoId,extension:".0000000.jpg"})}getFirstVideo(t,e){let i=t.steps.find(e=>e.key===t.startStep),o=`${e?`_${e}`:""}.mp4`,n=i.stockAsset?.videoUrl,r=!!i.stockAsset?.shopifyFileId,a=i.stockAsset?.previewUrl;if(a)return a;if(n&&!r){if(n.includes("vimeo"))return n;let t=n.split(".mp4")[0];return`${t}${o}`}let l=this.getVideoBaseUrl(t.baseUrl,i),d=i?.videoOwner||t?.owner;return(0,s.buildUrl)({path:l,ownerId:d,assetId:i.videoId,extension:o})}getVideoBaseUrl(t){return`${m.VIDEO_OUTPUT}/${t.includes("responses")?"responses":"public"}`}shouldLoadWidget(t,e,i){if(t)return!1;if("true"===(0,d.getTolstoyHideWidget)(this.widgetId))return!0;if(!e||0===e.length||i)return!1;let o=(0,n.default).stripUrl(window.location.href.split("?")[0]);return!e.some(t=>(0,n.default).stripUrl(t)===o)}shouldShowCloseButton(t){return!t.noCloseOption||!!t.widgetNotificationBadge&&!this.opened||!this.opened&&!!t.widgetNotificationBadge}getCloseButton(t){if(!this.shouldShowCloseButton(t))return"";let e=t.border||t.widgetBorderColor?"tolstoyBorderedBadgeContainer":"tolstoyBadgeContainer",i=`tolstoy-close-container ${B.tolstoyBadgeContainer}
        ${this.addMobileClass("tolstoyBadgeContainer",t.keepSettingsOnMobile)}

    ${this.selectMinifiedClass(t.minified,e,t.widgetShape,t.widgetSize)}`;return`<div class="${i}"><div role="button" tabindex="0" aria-label="Close Tolstoy widget" class="close-tolstoy-button ${B.closeButton}
    ${this.addMobileClass("closeButton",t.keepSettingsOnMobile)}
${this.selectMinifiedClass(t.minified,"closeButton",t.widgetShape,t.widgetSize)} ${t.widgetNotificationBadge&&!this.opened?B.closeButtonBadgeColor:""} ">
${t.widgetNotificationBadge&&!this.opened?"1":g.xButtonsSvg}
</div></div>
`}subscribeVideoEvents(){document.querySelector(".tolstoy-last-video-source").addEventListener("error",()=>{this.posterError||(this.previewLoaded=!0,this.display())})}subscribeEvents(t){let e=document.querySelector(`.${a.TOLSTOY_CONTENT_CONTAINER}`);e?.addEventListener("keypress",e=>{("Space"===e.code||"Enter"===e.code)&&this.open(t)}),e?.addEventListener("click",e=>{e.stopPropagation(),this.open(t)});let i=document.querySelector(".tolstoy-text-bubble-container");i?.addEventListener("click",e=>{e.stopPropagation(),this.open(t)});let o=document.querySelector(".close-tolstoy-button");t.noCloseOption||o.addEventListener("click",t=>{this.hide(t,!0),this.rules.updateRestrictions(p.STOP_SHOWING_WIDGET_TO.clickedX,this.widgetId)}),t.widgetNotificationBadge&&!t.noCloseOption&&(o.addEventListener("mouseenter",()=>{o.classList.remove(B.closeButtonBadgeColor),o.innerHTML=g.xButtonsSvg}),o.addEventListener("mouseleave",()=>{this.opened||o.classList.add(B.closeButtonBadgeColor),o.innerHTML=this.opened?g.xButtonsSvg:"1"}))}subscribeToVideoLoaded(t){let e=t.querySelector(".tolstoy-last-video-source").parentElement,i=()=>{this.previewLoaded=!0,this.display()};e.addEventListener("canplaythrough",i,{once:!0}),e.addEventListener("error",()=>{this.posterError=!0},{once:!0}),this.videoLoadingTimeout||(this.videoLoadingTimeout=setTimeout(()=>{!this.posterError&&this.videoLoadingTimeout&&i()},5e3))}}}),i("girDi",function(e,i){var o,n,r,s,a,l,d,u,c,b,g,h,p,y,f,w,m,B,v,T,C,S,M,E,x,_,I,R,D,O,P,$,L,H,A,F,W,V,z,N,G,k,U,q,Y,Q,j,K,J,Z,X;t(e.exports,"closeButton",function(){return o},function(t){return o=t}),t(e.exports,"closeButtonBadgeColor",function(){return n},function(t){return n=t}),t(e.exports,"closeButtonCircle",function(){return r},function(t){return r=t}),t(e.exports,"closeButtonSmall",function(){return s},function(t){return s=t}),t(e.exports,"tolstoyBadgeContainer",function(){return a},function(t){return a=t}),t(e.exports,"tolstoyBadgeContainerCircle",function(){return l},function(t){return l=t}),t(e.exports,"tolstoyBadgeContainerCircleLarge",function(){return d},function(t){return d=t}),t(e.exports,"tolstoyBadgeContainerSmall",function(){return u},function(t){return u=t}),t(e.exports,"tolstoyBorderedBadgeContainerCircle",function(){return c},function(t){return c=t}),t(e.exports,"tolstoyBorderedBadgeContainerCircleLarge",function(){return b},function(t){return b=t}),t(e.exports,"tolstoyBubble",function(){return g},function(t){return g=t}),t(e.exports,"tolstoyBubbleContainer",function(){return h},function(t){return h=t}),t(e.exports,"tolstoyBubbleText",function(){return p},function(t){return p=t}),t(e.exports,"tolstoyBubbleTextContainer",function(){return y},function(t){return y=t}),t(e.exports,"tolstoyBubbleTextTextContainer",function(){return f},function(t){return f=t}),t(e.exports,"tolstoyBubbleToggleContainer",function(){return w},function(t){return w=t}),t(e.exports,"tolstoyBubbleVerticalContainer",function(){return m},function(t){return m=t}),t(e.exports,"tolstoyButtonBottomLeft",function(){return B},function(t){return B=t}),t(e.exports,"tolstoyButtonBottomRight",function(){return v},function(t){return v=t}),t(e.exports,"tolstoyButtonCircle",function(){return T},function(t){return T=t}),t(e.exports,"tolstoyButtonCircleLarge",function(){return C},function(t){return C=t}),t(e.exports,"tolstoyButtonHorizontal",function(){return S},function(t){return S=t}),t(e.exports,"tolstoyButtonHorizontalCircle",function(){return M},function(t){return M=t}),t(e.exports,"tolstoyButtonHorizontalCircleLarge",function(){return E},function(t){return E=t}),t(e.exports,"tolstoyButtonHorizontalSmall",function(){return x},function(t){return x=t}),t(e.exports,"tolstoyButtonSmall",function(){return _},function(t){return _=t}),t(e.exports,"tolstoyButtonVertical",function(){return I},function(t){return I=t}),t(e.exports,"tolstoyButtonVerticalCircle",function(){return R},function(t){return R=t}),t(e.exports,"tolstoyButtonVerticalCircleLarge",function(){return D},function(t){return D=t}),t(e.exports,"tolstoyButtonVerticalSmall",function(){return O},function(t){return O=t}),t(e.exports,"tolstoyButtonWithInstagramBorder",function(){return P},function(t){return P=t}),t(e.exports,"tolstoyContentContainer",function(){return $},function(t){return $=t}),t(e.exports,"tolstoyFaceCloseUp",function(){return L},function(t){return L=t}),t(e.exports,"tolstoyVideoPositionBottom",function(){return H},function(t){return H=t}),t(e.exports,"tolstoyVideoPositionTop",function(){return A},function(t){return A=t}),t(e.exports,"videoPlayer",function(){return F},function(t){return F=t}),t(e.exports,"videoPlayerCircle",function(){return W},function(t){return W=t}),t(e.exports,"videoPlayerCircleLarge",function(){return V},function(t){return V=t}),t(e.exports,"videoPlayerSmall",function(){return z},function(t){return z=t}),t(e.exports,"videoPlayerWithInstagramBorder",function(){return N},function(t){return N=t}),t(e.exports,"widgetHeader",function(){return G},function(t){return G=t}),t(e.exports,"widgetHeaderAlignment-bottom",function(){return k},function(t){return k=t}),t(e.exports,"widgetHeaderAlignment-top",function(){return U},function(t){return U=t}),t(e.exports,"widgetHeaderCircle",function(){return q},function(t){return q=t}),t(e.exports,"widgetHeaderContainer",function(){return Y},function(t){return Y=t}),t(e.exports,"widgetHeaderContainerCircle",function(){return Q},function(t){return Q=t}),t(e.exports,"widgetHeaderContainerCircleLarge",function(){return j},function(t){return j=t}),t(e.exports,"widgetHeaderContainerSmall",function(){return K},function(t){return K=t}),t(e.exports,"widgetHeaderContainerWithBorder",function(){return J},function(t){return J=t}),t(e.exports,"widgetHeaderContainerWithInstagram",function(){return Z},function(t){return Z=t}),t(e.exports,"widgetHeaderSmall",function(){return X},function(t){return X=t}),o="MRFMva_closeButton",n="MRFMva_closeButtonBadgeColor",r="MRFMva_closeButtonCircle",s="MRFMva_closeButtonSmall",a="MRFMva_tolstoyBadgeContainer",l="MRFMva_tolstoyBadgeContainerCircle",d="MRFMva_tolstoyBadgeContainerCircleLarge",u="MRFMva_tolstoyBadgeContainerSmall",c="MRFMva_tolstoyBorderedBadgeContainerCircle",b="MRFMva_tolstoyBorderedBadgeContainerCircleLarge",g="MRFMva_tolstoyBubble",h="MRFMva_tolstoyBubbleContainer",p="MRFMva_tolstoyBubbleText",y="MRFMva_tolstoyBubbleTextContainer",f="MRFMva_tolstoyBubbleTextTextContainer",w="MRFMva_tolstoyBubbleToggleContainer",m="MRFMva_tolstoyBubbleVerticalContainer",B="MRFMva_tolstoyButtonBottomLeft",v="MRFMva_tolstoyButtonBottomRight",T="MRFMva_tolstoyButtonCircle",C="MRFMva_tolstoyButtonCircleLarge",S="MRFMva_tolstoyButtonHorizontal",M="MRFMva_tolstoyButtonHorizontalCircle",E="MRFMva_tolstoyButtonHorizontalCircleLarge",x="MRFMva_tolstoyButtonHorizontalSmall",_="MRFMva_tolstoyButtonSmall",I="MRFMva_tolstoyButtonVertical",R="MRFMva_tolstoyButtonVerticalCircle",D="MRFMva_tolstoyButtonVerticalCircleLarge",O="MRFMva_tolstoyButtonVerticalSmall",P="MRFMva_tolstoyButtonWithInstagramBorder",$="MRFMva_tolstoyContentContainer",L="MRFMva_tolstoyFaceCloseUp",H="MRFMva_tolstoyVideoPositionBottom",A="MRFMva_tolstoyVideoPositionTop",F="MRFMva_videoPlayer",W="MRFMva_videoPlayerCircle",V="MRFMva_videoPlayerCircleLarge",z="MRFMva_videoPlayerSmall",N="MRFMva_videoPlayerWithInstagramBorder",G="MRFMva_widgetHeader",k="MRFMva_widgetHeaderAlignment-bottom",U="MRFMva_widgetHeaderAlignment-top",q="MRFMva_widgetHeaderCircle",Y="MRFMva_widgetHeaderContainer",Q="MRFMva_widgetHeaderContainerCircle",j="MRFMva_widgetHeaderContainerCircleLarge",K="MRFMva_widgetHeaderContainerSmall",J="MRFMva_widgetHeaderContainerWithBorder",Z="MRFMva_widgetHeaderContainerWithInstagram",X="MRFMva_widgetHeaderSmall"}),i("f4aGe",function(e,i){var o,n,r,s,a,l,d,u,c,b,g,h,p;t(e.exports,"closeButton",function(){return o},function(t){return o=t}),t(e.exports,"tolstoyBadgeContainer",function(){return n},function(t){return n=t}),t(e.exports,"tolstoyBubble",function(){return r},function(t){return r=t}),t(e.exports,"tolstoyBubbleGolf",function(){return s},function(t){return s=t}),t(e.exports,"tolstoyBubbleText",function(){return a},function(t){return a=t}),t(e.exports,"tolstoyButtonBottomLeft",function(){return l},function(t){return l=t}),t(e.exports,"tolstoyButtonBottomRight",function(){return d},function(t){return d=t}),t(e.exports,"tolstoyButtonHorizontal",function(){return u},function(t){return u=t}),t(e.exports,"tolstoyButtonVertical",function(){return c},function(t){return c=t}),t(e.exports,"videoPlayer",function(){return b},function(t){return b=t}),t(e.exports,"widgetHeader",function(){return g},function(t){return g=t}),t(e.exports,"widgetHeaderContainer",function(){return h},function(t){return h=t}),t(e.exports,"widgetHeaderContainerWithInstagram",function(){return p},function(t){return p=t}),o="TDDQua_closeButton",n="TDDQua_tolstoyBadgeContainer",r="TDDQua_tolstoyBubble",s="TDDQua_tolstoyBubbleGolf",a="TDDQua_tolstoyBubbleText",l="TDDQua_tolstoyButtonBottomLeft",d="TDDQua_tolstoyButtonBottomRight",u="TDDQua_tolstoyButtonHorizontal",c="TDDQua_tolstoyButtonVertical",b="TDDQua_videoPlayer",g="TDDQua_widgetHeader",h="TDDQua_widgetHeaderContainer",p="TDDQua_widgetHeaderContainerWithInstagram"}),i("e0F8o",function(e,i){t(e.exports,"FEATURE_WIDGET_HEADER_CUSTOMIZATION",function(){return o});let o="widget-header-customization"}),i("e7ceA",function(e,i){t(e.exports,"getHexOpacity",function(){return n});let o=t=>t?Math.round(255*t).toString(16).toUpperCase().padStart(2,"0"):"",n=(t,e)=>`${t}${o(e)}`}),i("5GBWD",function(i,o){t(i.exports,"default",function(){return s});var n=e("aEodP"),r=e("8ptJJ"),s=class{constructor(t){this.tolstoyIframe=t,this.rechargeMessagingHandler=this.rechargeMessagingHandler.bind(this),this.playerReady=!1,this.playerReadyMessages=[],this.subscribeForPlayerStart(),this.init()}subscribeForPlayerStart(){window.addEventListener("message",t=>{if(t.data&&t.data.eventName===r.TOLSTOY_PLAYER_READY_MESSAGE){for(let t of(this.playerReady=!0,this.playerReadyMessages||[]))this.tolstoyIframe?.contentWindow?.postMessage(t,"*");this.playerReadyMessages=[]}})}safePostMessageToWindow(t){if(!this.playerReady)return this.playerReadyMessages.push(t);this.tolstoyIframe?.contentWindow.postMessage(t,"*")}async getRechargeWidgetData(){if(!window.ReChargeWidget)return;let t=await window.ReChargeWidget.api.fetchWidgetData();this.safePostMessageToWindow({eventName:r.RECHARGE_WIDGET_DATA_MESSAGE,rechargeWidgetData:t})}async rechargeAddToCart({rechargeCartItem:t,variantId:e}){if(window.ReChargeWidget)try{await window.ReChargeWidget.api.postToCart(t),this.safePostMessageToWindow({eventName:n.INTERNAL_EVENTS.addToCartSuccess,variantId:e})}catch{this.safePostMessageToWindow({eventName:n.INTERNAL_EVENTS.addToCartError,error:"Error adding to cart",variantId:e})}}rechargeMessagingHandler(t){if(t.data.name===r.RECHARGE_MESSAGING)switch(t.data.type){case r.REQUEST_RECHARGE_WIDGET_DATA_MESSAGE:return this.getRechargeWidgetData();case r.REQUEST_RECHARGE_ADD_TO_CART_MESSAGE:return this.rechargeAddToCart(t.data);default:return null}}init(){window.addEventListener("message",this.rechargeMessagingHandler)}}}),i("aejhc",function(i,o){t(i.exports,"handleOpenOrCloseEvent",function(){return l}),t(i.exports,"handleVideoPauseAndResumeEvents",function(){return d}),t(i.exports,"isTolstoyOpen",function(){return u});var n=e("50h3S"),r=e("eSOI5"),s=e("8ptJJ"),a=e("kCbDV");let l=({type:t,publishId:e})=>{if(!t||!e)return;let i=Date.now(),o=(0,r.getSessionId)();(0,r.pushTolstoyActivity)({publishId:e,timeStamp:i,type:t,sessionId:o})},d=t=>{let{videoPause:e,videoResume:i}=n.PLAYER_EVENTS,{publishId:o,playerType:l}=t.data;if(l!==a.EMBED_WIDGET||![e,i].includes(t.data.name))return;let d=Date.now(),u=(0,r.getSessionId)(),c=t.data.name===e?s.WIDGET_MESSAGES_EVENTS.PAUSE:s.WIDGET_MESSAGES_EVENTS.PLAY;(0,r.pushTolstoyActivity)({publishId:o,timeStamp:d,type:c,sessionId:u})},u=({publishId:t,sessionId:e})=>{if(!t||!e)return!1;let i=r.getTolstoysActivity()?.[t];if(!i?.length)return!1;let o=i[i.length-1];return o.type===s.WIDGET_MESSAGES_EVENTS.OPEN&&o.sessionId===e}})}();